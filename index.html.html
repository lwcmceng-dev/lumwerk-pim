<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lumwerk PIM ‚Äì Standalone (DE)</title>
  <style>
    :root{--lum:#F1D31A;--bg:#f7f7f8;--fg:#111827;--muted:#6b7280;--card:#ffffff;--border:#e5e7eb;}
    *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1120px;margin:0 auto;padding:0 16px}
    header{position:sticky;top:0;z-index:30;background:#111827;color:#fff;border-bottom:1px solid #0b0f1a}
    .hbar{height:64px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{width:36px;height:36px;border-radius:10px;background:var(--lum);color:#111;display:grid;place-items:center;font-weight:800}
    .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:13px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--lum);border-color:#eab308;color:#111}
    .btn.danger{background:#fee2e2;border-color:#fecaca;color:#7f1d1d}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .search{position:relative}
    .search input{padding:9px 12px 9px 28px;border:1px solid var(--border);border-radius:10px;width:220px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px}
    main{padding:16px 0 28px}
    .grid{display:grid;gap:14px}
    .grid.kpi{grid-template-columns:repeat(4,minmax(0,1fr))}
    .grid.cols-2{grid-template-columns:2fr 1fr}
    .grid.prods{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:1024px){.grid.kpi{grid-template-columns:repeat(2,1fr)}.grid.prods{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid.kpi,.grid.prods{grid-template-columns:1fr}.search input{width:160px}}
    .kpi-box{display:flex;align-items:center;gap:10px;padding:14px}
    .muted{color:var(--muted)}
    .prod-img{width:100%;height:150px;object-fit:cover;border-bottom:1px solid var(--border)}
    .pill{display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border)}
    .pill.green{background:#dcfce7;border-color:#bbf7d0;color:#166534}
    .pill.yellow{background:#fef9c3;border-color:#fde68a;color:#854d0e}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px;border-top:1px solid var(--border);text-align:left}
    .login-bg{min-height:100vh;background:linear-gradient(135deg,#111827,#1f2937 45%,var(--lum));display:grid;place-items:center;padding:16px}
    .login{width:100%;max-width:440px;background:#fff;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.15);overflow:hidden}
    .login .top{text-align:center;padding:26px 24px 8px}
    .login .fields{padding:0 24px 18px;display:grid;gap:10px}
    .login input{width:100%;border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    .login .actions{padding:0 24px 22px}
    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;padding:16px}
    .modal{width:100%;max-width:640px;background:#fff;border-radius:14px;border:1px solid var(--border)}
    .modal .hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
    .modal .bd{padding:14px 16px;display:grid;gap:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row > div{display:grid;gap:6px}
    input,select,textarea{border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    textarea{min-height:80px;resize:vertical}
    .modal .ft{display:flex;justify-content:flex-end;gap:8px;padding:14px 16px;border-top:1px solid var(--border)}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel (CDN) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Utilities ---
    const fmtEUR = n => new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR'}).format(Number(n||0));
    const load = (k, fallback) => { try{ const v = JSON.parse(localStorage.getItem(k)); return Array.isArray(v)||v? v : fallback; } catch{ return fallback; } };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

    // --- Demo-User ---
    const DEMO_USERS = [
      {u:'admin',   p:'admin',   name:'Administrator'},
      {u:'sales',   p:'sales',   name:'Sales Manager'},
      {u:'product', p:'product', name:'Product Manager'},
      {u:'editor',  p:'editor',  name:'Content Editor'},
    ];

    // --- Produkt-Modal (Anlegen/Bearbeiten) ---
    function ProduktModal({initial, onCancel, onSave}) {
      const [form, setForm] = useState(initial || {
        id: null,
        artikelnummer: '',
        name: '',
        kategorie: 'Beleuchtung',
        beschreibung: '',
        preis: 0,
        b2b: 0,
        marge: 0,
        bestand: 'Auf Lager',
        status: 'Aktiv',
        bild: 'https://picsum.photos/seed/lw'+Math.round(Math.random()*999)+'/800/600',
        aufrufe: 0,
        interessenten: 0,
        conversion: 0
      });

      function handleNum(key, val) {
        const n = val === '' ? '' : Number(val);
        setForm(prev => ({...prev, [key]: n}));
      }

      function submit() {
        // einfache Validierung
        if (!form.artikelnummer.trim()) return alert('Bitte Artikelnummer eingeben.');
        if (!form.name.trim()) return alert('Bitte Produktname eingeben.');
        if (form.preis === '' || isNaN(form.preis)) return alert('Bitte g√ºltigen Preis eingeben.');
        if (form.b2b === '' || isNaN(form.b2b)) return alert('Bitte g√ºltigen B2B-Preis eingeben.');
        onSave(form);
      }

      return (
        <div className="modal-backdrop" onClick={onCancel}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className="hd">
              <b>{form.id ? 'Produkt bearbeiten' : 'Produkt anlegen'}</b>
              <button className="btn" onClick={onCancel}>Schlie√üen</button>
            </div>
            <div className="bd">
              <div className="row">
                <div>
                  <label>Artikelnummer</label>
                  <input value={form.artikelnummer} onChange={e=>setForm({...form, artikelnummer:e.target.value})} placeholder="z. B. LW-001" />
                </div>
                <div>
                  <label>Produktname</label>
                  <input value={form.name} onChange={e=>setForm({...form, name:e.target.value})} placeholder="z. B. Smart LED Panel Pro" />
                </div>
              </div>

              <div className="row">
                <div>
                  <label>Kategorie</label>
                  <select value={form.kategorie} onChange={e=>setForm({...form, kategorie:e.target.value})}>
                    <option>Beleuchtung</option>
                    <option>Outdoor</option>
                    <option>Smart Home</option>
                    <option>Sonstiges</option>
                  </select>
                </div>
                <div>
                  <label>Status</label>
                  <select value={form.status} onChange={e=>setForm({...form, status:e.target.value})}>
                    <option>Aktiv</option>
                    <option>Inaktiv</option>
                    <option>In Pr√ºfung</option>
                  </select>
                </div>
              </div>

              <div className="row">
                <div>
                  <label>Preis (VK, ‚Ç¨)</label>
                  <input type="number" step="0.01" value={form.preis} onChange={e=>handleNum('preis', e.target.value)} />
                </div>
                <div>
                  <label>B2B-Preis (‚Ç¨)</label>
                  <input type="number" step="0.01" value={form.b2b} onChange={e=>handleNum('b2b', e.target.value)} />
                </div>
              </div>

              <div className="row">
                <div>
                  <label>Marge (%)</label>
                  <input type="number" step="1" value={form.marge} onChange={e=>handleNum('marge', e.target.value)} />
                </div>
                <div>
                  <label>Bestand</label>
                  <select value={form.bestand} onChange={e=>setForm({...form, bestand:e.target.value})}>
                    <option>Auf Lager</option>
                    <option>Geringer Bestand</option>
                    <option>Nicht verf√ºgbar</option>
                  </select>
                </div>
              </div>

              <div>
                <label>Beschreibung</label>
                <textarea value={form.beschreibung} onChange={e=>setForm({...form, beschreibung:e.target.value})} placeholder="Kurzbeschreibung"></textarea>
              </div>

              <div>
                <label>Bild-URL</label>
                <input value={form.bild} onChange={e=>setForm({...form, bild:e.target.value})} />
              </div>
            </div>
            <div className="ft">
              <button className="btn" onClick={onCancel}>Abbrechen</button>
              <button className="btn primary" onClick={submit}>{form.id ? 'Speichern' : 'Anlegen'}</button>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [user, setUser] = useState(null);
      const [tab, setTab] = useState('dashboard');
      const [search, setSearch] = useState('');
      const [kategorie, setKategorie] = useState('alle');
      const [showModal, setShowModal] = useState(false);
      const [editItem, setEditItem] = useState(null);

      // Daten laden/speichern
      const [produkte, setProdukte] = useState(() => load('lumwerk_products_v1', [
        { id:1, artikelnummer:'LW-001', name:'Smart LED Panel Pro', kategorie:'Beleuchtung', beschreibung:'Professionelles LED-Panel mit App-Steuerung und Farbwechsel', preis:299.99, b2b:249.99, marge:40, bestand:'Auf Lager', status:'Aktiv', bild:'https://picsum.photos/seed/lw001/800/600', aufrufe:1250, interessenten:28, conversion:3.2 },
        { id:2, artikelnummer:'LW-002', name:'Outdoor Strahler IP65', kategorie:'Outdoor', beschreibung:'Wetterfester LED-Strahler f√ºr Au√üenanwendungen', preis:149.99, b2b:124.99, marge:40, bestand:'Geringer Bestand', status:'Aktiv', bild:'https://picsum.photos/seed/lw002/800/600', aufrufe:890, interessenten:15, conversion:2.8 }
      ]));

      useEffect(()=> save('lumwerk_products_v1', produkte), [produkte]);

      // ---- Login ----
      function Login() {
        const [u, setU] = useState(''); const [p, setP] = useState('');
        function submit(e){ e.preventDefault(); const ok = DEMO_USERS.find(x => x.u===u && x.p===p); if(ok) setUser({name:ok.name, u}); else alert('Falsche Zugangsdaten. Demo: admin/admin'); }
        return (
          <div className="login-bg">
            <div className="login">
              <div className="top">
                <div className="logo">LW</div>
                <h1 style={{margin:'10px 0 3px'}}>Lumwerk PIM</h1>
                <div className="muted">Anmeldung</div>
              </div>
              <form className="fields" onSubmit={submit}>
                <div>
                  <div className="muted" style={{fontSize:13}}>Benutzername</div>
                  <input value={u} onChange={e=>setU(e.target.value)} placeholder="z. B. admin" required />
                </div>
                <div>
                  <div className="muted" style={{fontSize:13}}>Passwort</div>
                  <input type="password" value={p} onChange={e=>setP(e.target.value)} placeholder="z. B. admin" required />
                </div>
                <div className="actions">
                  <button className="btn primary" type="submit">Anmelden</button>
                </div>
              </form>
              <div style="background:#f9fafb;padding:12px 24px 16px">
                <div class="muted" style="font-size:13px;margin-bottom:6px">Schnell-Login:</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                  ${DEMO_USERS.map(u => `<button class="btn" onclick="document.querySelector('#root').__quickLogin('${u.u}')"><b>${u.name}</b><span class="muted" style="font-size:12px">${u.u} / ${u.p}</span></button>`).join('')}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Hilfs-Handler f√ºr Schnell-Login (kleiner Trick ohne extra Props)
      useEffect(()=>{ document.getElementById('root').__quickLogin = (u)=>{ const x = DEMO_USERS.find(d=>d.u===u); if(x) setUser({name:x.name,u:x.u}); }; }, []);

      // ---- Dashboard ----
      function Dashboard() {
        const kpis = [
          {label:'Produkte',  value: produkte.length, icon:'üì¶'},
          {label:'Kategorien',value: new Set(produkte.map(p=>p.kategorie)).size, icon:'üóÇÔ∏è'},
          {label:'Interessenten', value: produkte.reduce((a,p)=>a+(p.interessenten||0),0), icon:'‚ù§Ô∏è'},
          {label:'Preis√§nderungen', value: 2, icon:'‚Ç¨'},
        ];
        return (
          <section className="grid" style={{gap:14}}>
            <div className="grid kpi">
              {kpis.map((k,i)=>(
                <div key={i} className="card kpi-box">
                  <div style="font-size:20px">${k.icon}</div>
                  <div><div class="muted" style="font-size:13px">${k.label}</div><div style="font-weight:700;font-size:20px">${k.value}</div></div>
                </div>
              ))}
            </div>
            <div className="grid cols-2">
              <div className="card">
                <div style="padding:12px 14px;border-bottom:1px solid var(--border);font-weight:600">Aktivit√§t</div>
                <ul style="margin:0;padding:0;list-style:none">
                  <li style="display:flex;gap:10px;padding:12px 14px;border-top:1px solid var(--border)"><b>Lisa Klein</b> hat Produkt ‚ÄûSmart LED Panel Pro‚Äù bearbeitet ‚Äì <span class="muted">vor 15 Min</span></li>
                  <li style="display:flex;gap:10px;padding:12px 14px;border-top:1px solid var(--border)"><b>Anna Schmidt</b> hat Preis f√ºr ‚ÄûOutdoor Strahler IP65‚Äù angepasst ‚Äì <span class="muted">vor 1 Std</span></li>
                </ul>
              </div>
              <div className="card" style="padding:12px 14px">
                <div style="font-weight:600;margin-bottom:8px">Schnellzugriff</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                  <button class="btn" onclick="${""}">Berichte</button>
                  <button class="btn" onclick="${""}">Einstellungen</button>
                  <button class="btn" onclick="${""}">Import</button>
                  <button class="btn" onclick="${""}">Export</button>
                </div>
              </div>
            </div>
          </section>
        );
      }

      // ---- Produkte ----
      function Produkte() {
        const cats = ['alle', ...Array.from(new Set(produkte.map(p=>p.kategorie)))];
        const list = produkte
          .filter(p => (kategorie==='alle' || p.kategorie===kategorie))
          .filter(p => [p.artikelnummer,p.name,p.kategorie].join(' ').toLowerCase().includes(search.toLowerCase()));

        function addProduct() { setEditItem(null); setShowModal(true); }
        function editProduct(p) { setEditItem(p); setShowModal(true); }
        function removeProduct(id) {
          if (!confirm('Produkt wirklich l√∂schen?')) return;
          setProdukte(prev => prev.filter(p => p.id !== id));
        }
        function exportCSV() {
          const headers = ['Artikelnummer','Name','Kategorie','Preis','B2B','Marge','Bestand','Status'];
          const rows = list.map(p => [p.artikelnummer,p.name,p.kategorie,p.preis,p.b2b,p.marge,p.bestand,p.status]);
          const data = [headers, ...rows].map(r=>r.join(';')).join('\n');
          const blob = new Blob([data], {type:'text/csv;charset=utf-8;'});
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob); a.download = 'produkte.csv'; a.click();
          URL.revokeObjectURL(a.href);
        }
        function onSave(form) {
          if (form.id) {
            setProdukte(prev => prev.map(p => p.id===form.id ? {...p, ...form} : p));
          } else {
            const nextId = Math.max(0, ...produkte.map(p=>p.id)) + 1;
            setProdukte(prev => [...prev, {...form, id: nextId}]);
          }
          setShowModal(false);
        }

        return (
          <section className="grid" style={{gap:14}}>
            <div className="card" style="padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px">
              <div style="display:flex;gap:8px;align-items:center">
                <button class="btn primary" onClick={addProduct}>+ Produkt anlegen</button>
                <button class="btn" onClick={exportCSV}>CSV exportieren</button>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="search"><span style="position:absolute;left:8px;top:7px;opacity:.5">üîé</span><input placeholder="Suche‚Ä¶" value={search} onChange={e=>setSearch(e.target.value)} /></div>
                <select class="btn" style="padding:8px 10px" value={kategorie} onChange={e=>setKategorie(e.target.value)}>
                  {cats.map(c => <option key={c} value={c}>{c==='alle'?'Alle Kategorien':c}</option>)}
                </select>
              </div>
            </div>

            <div className="grid prods">
              {list.map(p => (
                <div className="card" key={p.id} style="display:flex;flex-direction:column">
                  <img class="prod-img" src={p.bild} alt={p.name} />
                  <div style="padding:12px 14px;display:grid;gap:8px;flex:1">
                    <div style="display:flex;justify-content:space-between;gap:8px">
                      <div>
                        <div class="muted" style="font-size:13px">{p.artikelnummer}</div>
                        <div style="font-weight:700">{p.name}</div>
                      </div>
                      <div style="text-align:right">
                        <div class="pill green">{p.status}</div>
                        <div class="pill yellow" style="margin-top:4px">{p.bestand}</div>
                      </div>
                    </div>
                    <div class="muted" style="font-size:14px">{p.beschreibung}</div>
                    <div style="display:flex;justify-content:space-between;align-items:center">
                      <div style="font-weight:700">{fmtEUR(p.preis)}</div>
                      <div class="muted" style="font-size:13px">Marge {p.marge}%</div>
                    </div>
                    <div style="display:flex;gap:8px;margin-top:auto">
                      <button class="btn" onClick={()=>editProduct(p)}>Bearbeiten</button>
                      <button class="btn danger" onClick={()=>removeProduct(p.id)}>L√∂schen</button>
                    </div>
                  </div>
                </div>
              ))}
              {list.length===0 && <div class="card" style="padding:14px;text-align:center">Keine Produkte gefunden.</div>}
            </div>

            {showModal && (
              <ProduktModal
                initial={editItem}
                onCancel={()=>setShowModal(false)}
                onSave={onSave}
              />
            )}
          </section>
        );
      }

      // ---- Kunden (Stub ‚Äì erweiterbar) ---
      function Kunden() {
        return (
          <section className="card" style="overflow:hidden">
            <div style="padding:12px 14px;border-bottom:1px solid var(--border);font-weight:600">Kunden (Demo)</div>
            <div style="padding:12px 14px">Kundenverwaltung folgt ‚Äì Fokus aktuell auf Produktverwaltung.</div>
          </section>
        );
      }

      // ---- App-Rahmen ----
      if (!user) return <Login />;

      return (
        <div>
          <header>
            <div className="wrap hbar">
              <div style="display:flex;align-items:center;gap:10px">
                <div class="logo">LW</div>
                <div><div style="font-weight:700">Lumwerk</div><div class="muted" style="font-size:12px">PIM</div></div>
                <nav style="margin-left:12px;display:flex;gap:6px">
                  {['dashboard','produkte','kunden'].map(id => (
                    <button key={id} className="chip" style={{background:tab===id?'var(--lum)':'#fff'}} onClick={()=>setTab(id)}>
                      {id==='dashboard'?'Dashboard':id==='produkte'?'Produkte':'Kunden'}
                    </button>
                  ))}
                </nav>
              </div>
              <div style="display:flex;align-items:center;gap:8px">
                <div class="chip">{user.name}</div>
                <button class="btn" onClick={()=>setUser(null)}>Abmelden</button>
              </div>
            </div>
          </header>

          <main className="wrap">
            {tab==='dashboard' && <Dashboard />}
            {tab==='produkte' && <Produkte />}
            {tab==='kunden' && <Kunden />}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
